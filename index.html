<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Smart Nap - 仮眠スペース予約</title>

  <!-- React / Babel / Tailwind / Lucide -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

  <!-- ★追加: Leaflet（地図） -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <style>
    /* Leaflet の画像が崩れないように（Tailwind のリセット対策） */
    .leaflet-container img { max-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Mock Data
    const mockUser = {
      id: 1,
      name: "田中太郎",
      nickname: "タナタナ",
      email: "tanaka@example.com",
      memberType: "一般",
      favorites: [1, 3],
      bookings: []
    };

    // 画像は GitHub Raw など
    const githubImageUrl = "https://raw.githubusercontent.com/a24z7km/smartnap/main/images/pod-image.jpeg";

    // ★緯度経度を追加
    const mockVenues = [
      {
        id: 1,
        name: "渋谷スリープボックス",
        type: "オフィスPod",
        address: "東京都渋谷区道玄坂2-1-1",
        distance: 0.3,
        rating: 4.5,
        minPrice: 800,
        image: githubImageUrl,
        lat: 35.6595,
        lng: 139.7005,
        amenities: ["防音", "リクライニング", "電源", "アロマ"],
        rooms: [
          { id: 1, name: "プレミアムPod A", type: "個室", capacity: 1, basePrice: 800 },
          { id: 2, name: "スタンダードPod B", type: "半個室", capacity: 1, basePrice: 600 }
        ]
      },
      {
        id: 2,
        name: "新宿ナップステーション",
        type: "オフィスPod",
        address: "東京都新宿区歌舞伎町1-2-3",
        distance: 0.8,
        rating: 4.2,
        minPrice: 500,
        image: githubImageUrl,
        lat: 35.6950,
        lng: 139.7020,
        amenities: ["防音", "照明調光"],
        rooms: [
          { id: 3, name: "サイレントルーム 1", type: "個室", capacity: 1, basePrice: 500 }
        ]
      },
      {
        id: 3,
        name: "六本木タケアナップ",
        type: "オフィスPod",
        address: "東京都港区六本木3-4-5",
        distance: 1.2,
        rating: 4.7,
        minPrice: 1000,
        image: githubImageUrl,
        lat: 35.6605,
        lng: 139.7293,
        amenities: ["防音", "リクライニング", "電源", "照明調光"],
        rooms: [
          { id: 4, name: "エグゼクティブPod", type: "Pod", capacity: 1, basePrice: 1000 }
        ]
      }
    ];

    const timeSlots = [
      "13:00","13:15","13:30","13:45","14:00","14:15","14:30","14:45",
      "15:00","15:15","15:30","15:45","16:00","16:15","16:30","16:45",
      "17:00","17:15","17:30","17:45"
    ];

    const amenityIconNames = {
      "防音": "volume-2",
      "リクライニング": "user",
      "電源": "zap",
      "アロマ": "leaf",
      "照明調光": "sun"
    };

    // ★追加: 地図コンポーネント
    function MapBox({ venues, onSelectVenue }) {
      const mapElRef = useRef(null);
      const mapRef = useRef(null);
      const markersLayerRef = useRef(null);

      useEffect(() => {
        // 初回のみマップ生成
        if (!mapRef.current) {
          mapRef.current = L.map(mapElRef.current, {
            center: [35.6762, 139.6503], // 東京中心あたり
            zoom: 12,
          });

          L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> contributors'
          }).addTo(mapRef.current);

          markersLayerRef.current = L.layerGroup().addTo(mapRef.current);
        }

        // マーカー更新
        const layer = markersLayerRef.current;
        layer.clearLayers();

        const bounds = [];
        venues.forEach(v => {
          if (typeof v.lat === "number" && typeof v.lng === "number") {
            const m = L.marker([v.lat, v.lng])
              .on("click", () => onSelectVenue(v))
              .addTo(layer);

            // 軽いポップアップ（クリックで詳細へ遷移）
            m.bindPopup(`
              <div style="font-size:14px; line-height:1.3;">
                <div style="font-weight:600;">${v.name}</div>
                <div>¥${v.minPrice}/15分〜</div>
                <button id="go-${v.id}" style="
                  margin-top:6px;padding:6px 10px;border-radius:8px;border:none;
                  background:#3b82f6;color:#fff;cursor:pointer;
                ">詳細・予約</button>
              </div>
            `);

            m.on("popupopen", () => {
              const btn = document.getElementById(`go-${v.id}`);
              if (btn) btn.onclick = () => onSelectVenue(v);
            });

            bounds.push([v.lat, v.lng]);
          }
        });

        if (bounds.length) {
          mapRef.current.fitBounds(bounds, { padding: [20, 20] });
        }

        // クリーンアップ（アンマウント時）
        return () => {};
      }, [venues, onSelectVenue]);

      return <div ref={mapElRef} className="w-full h-72 rounded-lg border" />;
    }

    function SmartNapApp() {
      const [currentView, setCurrentView] = useState("home");
      const [selectedVenue, setSelectedVenue] = useState(null);
      const [selectedRoom, setSelectedRoom] = useState(null);
      const [selectedTime, setSelectedTime] = useState(null);
      const [duration, setDuration] = useState(15);
      const [searchQuery, setSearchQuery] = useState("");
      const [filterType, setFilterType] = useState("all");
      const [favorites, setFavorites] = useState(mockUser.favorites);
      const [bookings, setBookings] = useState([]);
      const [currentBooking, setCurrentBooking] = useState(null);

      useEffect(() => {
        lucide.createIcons();
      });

      const filteredVenues = mockVenues
        .filter(venue => {
          const q = searchQuery.toLowerCase();
          const matchesSearch =
            venue.name.toLowerCase().includes(q) ||
            venue.address.toLowerCase().includes(q);
          const matchesType = filterType === "all" || venue.type === filterType;
          return matchesSearch && matchesType;
        })
        .sort((a, b) => a.distance - b.distance);

      const toggleFavorite = (venueId) => {
        setFavorites(prev =>
          prev.includes(venueId)
            ? prev.filter(id => id !== venueId)
            : [...prev, venueId]
        );
      };

      const generateQRCode = (bookingId) => {
        const size = 200;
        const cellSize = size / 20;
        const qrPattern = [
          [1,1,1,1,1,1,1,0,1,0,1,0,1,1,1,1,1,1,1,1],
          [1,0,0,0,0,0,1,0,1,1,0,0,1,0,0,0,0,0,0,1],
          [1,0,1,1,1,0,1,0,0,1,1,0,1,0,1,1,1,0,0,1],
          [1,0,1,1,1,0,1,0,1,0,0,1,1,0,1,1,1,0,0,1],
          [1,0,1,1,1,0,1,0,0,1,0,1,1,0,1,1,1,0,0,1],
          [1,0,0,0,0,0,1,0,1,1,1,0,1,0,0,0,0,0,0,1],
          [1,1,1,1,1,1,1,0,1,0,1,0,1,1,1,1,1,1,1,1],
          [0,0,0,0,0,0,0,0,1,1,0,1,0,0,0,0,0,0,0,0],
          [1,0,1,1,0,1,1,1,0,1,1,0,1,1,0,0,1,0,1,1],
          [0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,1,0,1,0,0],
          [1,1,1,0,0,1,1,1,1,0,1,0,1,1,1,0,1,0,1,1],
          [0,0,0,1,1,0,0,0,0,1,0,1,0,0,0,1,0,1,0,0],
          [1,1,1,1,1,1,1,0,1,1,1,0,1,0,1,1,1,0,1,1],
          [1,0,0,0,0,0,1,0,0,0,1,1,0,1,0,0,0,1,0,0],
          [1,0,1,1,1,0,1,0,1,1,0,0,1,0,1,1,1,0,1,1],
          [1,0,1,1,1,0,1,0,0,1,1,1,0,1,0,0,0,1,0,0],
          [1,0,1,1,1,0,1,0,1,0,0,0,1,0,1,1,1,0,1,1],
          [1,0,0,0,0,0,1,0,0,1,1,1,0,1,0,0,0,1,0,0],
          [1,1,1,1,1,1,1,0,1,0,1,0,1,1,1,1,1,1,1,1],
          [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
        ];

        return (
          <svg width={size} height={size} className="mx-auto">
            {qrPattern.map((row, i) =>
              row.map((cell, j) => (
                <rect
                  key={`${i}-${j}`}
                  x={j * (cellSize)}
                  y={i * (cellSize)}
                  width={cellSize}
                  height={cellSize}
                  fill={cell ? "#000" : "#fff"}
                />
              ))
            )}
          </svg>
        );
      };

      const calculatePrice = () => {
        if (!selectedRoom) return 0;
        return selectedRoom.basePrice * (duration / 15);
      };

      const createBooking = () => {
        const booking = {
          id: Date.now(),
          venue: selectedVenue,
          room: selectedRoom,
          time: selectedTime,
          duration: duration,
          price: calculatePrice(),
          status: "confirmed",
          date: new Date().toISOString().split("T")[0]
        };
        setBookings(prev => [...prev, booking]);
        setCurrentBooking(booking);
        setCurrentView("confirmation");
      };

      const HomeView = () => (
        <div className="space-y-6">
          <div className="bg-gradient-to-r from-slate-800 to-slate-600 p-6 rounded-lg text-white">
            <h1 className="text-2xl font-bold mb-4">Smart Nap</h1>
            <div className="relative mb-4">
              <i data-lucide="search" className="absolute left-3 top-3 w-5 h-5 text-gray-400"></i>
              <input
                type="text"
                placeholder="エリアや施設名で検索..."
                className="w-full pl-10 pr-4 py-2 rounded-lg text-gray-800"
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
              />
            </div>
            <div className="flex gap-2 flex-wrap">
              {['all', 'オフィスPod', 'ホテル', 'カラオケ'].map(type => (
                <button
                  key={type}
                  onClick={() => setFilterType(type)}
                  className={`px-3 py-1 rounded-full text-sm ${
                    filterType === type ? 'bg-blue-500 text-white' : 'bg-white text-gray-700'
                  }`}
                >
                  {type === 'all' ? 'すべて' : type}
                </button>
              ))}
            </div>
          </div>

          {/* ★地図（ピン選択で詳細へ） */}
          <MapBox
            venues={filteredVenues}
            onSelectVenue={(v) => {
              setSelectedVenue(v);
              setCurrentView('venue-detail');
            }}
          />

          <div className="space-y-4">
            <h2 className="text-lg font-semibold text-gray-800">おすすめ施設</h2>
            {filteredVenues.map(venue => (
              <div key={venue.id} className="border rounded-lg p-4 bg-white shadow-sm">
                <div className="flex gap-4">
                  <img
                    src={venue.image}
                    alt={venue.name}
                    className="w-20 h-20 rounded-lg object-cover"
                  />
                  <div className="flex-1">
                    <div className="flex justify-between items-start mb-2">
                      <div>
                        <h3 className="font-semibold text-gray-800">{venue.name}</h3>
                        <p className="text-sm text-gray-500">{venue.type}</p>
                      </div>
                      <button onClick={() => toggleFavorite(venue.id)} className="p-1">
                        <i
                          data-lucide="heart"
                          className={`w-5 h-5 ${
                            favorites.includes(venue.id) ? 'text-red-500 fill-current' : 'text-gray-400'
                          }`}
                        ></i>
                      </button>
                    </div>
                    <div className="flex items-center gap-2 mb-2">
                      <i data-lucide="star" className="w-4 h-4 text-yellow-400 fill-current"></i>
                      <span className="text-sm text-gray-600">{venue.rating}</span>
                      <i data-lucide="map-pin" className="w-4 h-4 text-gray-400"></i>
                      <span className="text-sm text-gray-600">{venue.distance}km</span>
                    </div>
                    <div className="flex items-center gap-2 mb-3">
                      {venue.amenities.map(amenity => (
                        <div key={amenity} className="flex items-center gap-1 text-xs bg-gray-100 px-2 py-1 rounded">
                          <i data-lucide={amenityIconNames[amenity]} className="w-3 h-3"></i>
                          <span>{amenity}</span>
                        </div>
                      ))}
                    </div>
                    <div className="flex justify-between items-center">
                      <div className="text-sm text-gray-600">
                        <span className="font-semibold text-lg text-green-600">¥{venue.minPrice}</span>
                        /15分〜
                      </div>
                      <button
                        onClick={() => {
                          setSelectedVenue(venue);
                          setCurrentView('venue-detail');
                        }}
                        className="px-4 py-2 bg-blue-500 text-white rounded-lg text-sm hover:bg-blue-600"
                      >
                        詳細・予約
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      );

      const VenueDetailView = () => (
        <div className="space-y-6">
          <button onClick={() => setCurrentView('home')} className="text-blue-500 text-sm">← 戻る</button>

          <div className="space-y-4">
            <img src={selectedVenue.image} alt={selectedVenue.name} className="w-full h-48 rounded-lg object-cover" />

            <div>
              <div className="flex justify-between items-start mb-2">
                <div>
                  <h1 className="text-2xl font-bold text-gray-800">{selectedVenue.name}</h1>
                  <p className="text-gray-600">{selectedVenue.type}</p>
                </div>
                <button onClick={() => toggleFavorite(selectedVenue.id)} className="p-2">
                  <i
                    data-lucide="heart"
                    className={`w-6 h-6 ${favorites.includes(selectedVenue.id) ? 'text-red-500 fill-current' : 'text-gray-400'}`}
                  ></i>
                </button>
              </div>

              <div className="flex items-center gap-4 mb-4">
                <div className="flex items-center gap-1">
                  <i data-lucide="star" className="w-4 h-4 text-yellow-400 fill-current"></i>
                  <span>{selectedVenue.rating}</span>
                </div>
                <div className="flex items-center gap-1">
                  <i data-lucide="map-pin" className="w-4 h-4 text-gray-400"></i>
                  <span className="text-sm">{selectedVenue.distance}km</span>
                </div>
              </div>

              <p className="text-gray-600 mb-4">{selectedVenue.address}</p>

              <div className="flex gap-2 mb-6">
                {selectedVenue.amenities.map(amenity => (
                  <div key={amenity} className="flex items-center gap-1 bg-gray-100 px-3 py-2 rounded">
                    <i data-lucide={amenityIconNames[amenity]} className="w-4 h-4"></i>
                    <span className="text-sm">{amenity}</span>
                  </div>
                ))}
              </div>
            </div>

            <div>
              <h2 className="text-lg font-semibold mb-4">利用可能な部屋</h2>
              <div className="space-y-3">
                {selectedVenue.rooms.map(room => (
                  <div key={room.id} className="border rounded-lg p-4">
                    <div className="flex justify-between items-center">
                      <div>
                        <h3 className="font-semibold">{room.name}</h3>
                        <p className="text-sm text-gray-600">{room.type} • 定員{room.capacity}名</p>
                        <p className="text-lg font-semibold text-green-600">¥{room.basePrice}/15分</p>
                      </div>
                      <button
                        onClick={() => { setSelectedRoom(room); setCurrentView('booking'); }}
                        className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600"
                      >
                        予約する
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            </div>

          </div>
        </div>
      );

      const BookingView = () => (
        <div className="space-y-6">
          <button onClick={() => setCurrentView('venue-detail')} className="text-blue-500 text-sm">← 戻る</button>

          <div className="bg-white p-6 rounded-lg border">
            <h1 className="text-xl font-bold mb-4">予約情報</h1>

            <div className="space-y-4 mb-6">
              <div>
                <p className="text-sm text-gray-600">施設</p>
                <p className="font-semibold">{selectedVenue.name}</p>
              </div>
              <div>
                <p className="text-sm text-gray-600">部屋</p>
                <p className="font-semibold">{selectedRoom.name}</p>
              </div>
            </div>

            <div className="space-y-4 mb-6">
              <div>
                <label className="block text-sm font-semibold mb-2">日付</label>
                <input type="date" className="w-full p-2 border rounded-lg" defaultValue={new Date().toISOString().split('T')[0]} />
              </div>

              <div>
                <label className="block text-sm font-semibold mb-2">開始時刻</label>
                <div className="grid grid-cols-4 gap-2">
                  {timeSlots.map(time => (
                    <button
                      key={time}
                      onClick={() => setSelectedTime(time)}
                      className={`p-2 text-sm border rounded ${
                        selectedTime === time ? 'bg-blue-500 text-white border-blue-500' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'
                      }`}
                    >
                      {time}
                    </button>
                  ))}
                </div>
              </div>

              <div>
                <label className="block text-sm font-semibold mb-2">利用時間</label>
                <div className="flex gap-2">
                  {[15, 30, 45, 60].map(min => (
                    <button
                      key={min}
                      onClick={() => setDuration(min)}
                      className={`px-4 py-2 text-sm border rounded ${
                        duration === min ? 'bg-blue-500 text-white border-blue-500' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'
                      }`}
                    >
                      {min}分
                    </button>
                  ))}
                </div>
              </div>
            </div>

            <div className="border-t pt-4 mb-6">
              <div className="flex justify-between items-center mb-2">
                <span>基本料金 ({duration}分)</span>
                <span>¥{calculatePrice()}</span>
              </div>
              <div className="flex justify-between items-center font-semibold text-lg">
                <span>合計</span>
                <span className="text-green-600">¥{calculatePrice()}</span>
              </div>
            </div>

            <button
              onClick={createBooking}
              disabled={!selectedTime}
              className="w-full py-3 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 disabled:bg-gray-300"
            >
              <div className="flex items-center justify-center gap-2">
                <i data-lucide="credit-card" className="w-4 h-4"></i>
                予約・決済に進む
              </div>
            </button>
          </div>
        </div>
      );

      const ConfirmationView = () => (
        <div className="space-y-6">
          <div className="bg-green-50 border border-green-200 p-6 rounded-lg text-center">
            <i data-lucide="check" className="w-12 h-12 text-green-500 mx-auto mb-4"></i>
            <h1 className="text-xl font-bold text-green-800 mb-2">予約完了</h1>
            <p className="text-green-700">ご予約ありがとうございます</p>
          </div>

          {currentBooking && (
            <div className="bg-white p-6 rounded-lg border">
              <h2 className="text-lg font-semibold mb-4">予約詳細</h2>
              <div className="space-y-3">
                <div className="flex justify-between"><span className="text-gray-600">予約ID</span><span className="font-mono">#{currentBooking.id}</span></div>
                <div className="flex justify-between"><span className="text-gray-600">施設</span><span>{currentBooking.venue.name}</span></div>
                <div className="flex justify-between"><span className="text-gray-600">部屋</span><span>{currentBooking.room.name}</span></div>
                <div className="flex justify-between"><span className="text-gray-600">日時</span><span>{currentBooking.date} {currentBooking.time}</span></div>
                <div className="flex justify-between"><span className="text-gray-600">利用時間</span><span>{currentBooking.duration}分</span></div>
                <div className="flex justify-between font-semibold"><span>料金</span><span>¥{currentBooking.price}</span></div>
              </div>
            </div>
          )}

          <div className="flex gap-3">
            <button onClick={() => setCurrentView('bookings')} className="flex-1 py-3 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600">予約一覧へ</button>
            <button onClick={() => setCurrentView('home')} className="flex-1 py-3 bg-gray-500 text-white rounded-lg font-semibold hover:bg-gray-600">ホームへ</button>
          </div>
        </div>
      );

      const FavoritesView = () => {
        const favoriteVenues = mockVenues.filter(venue => favorites.includes(venue.id));
        return (
          <div className="space-y-6">
            <div className="flex justify-between items-center">
              <h1 className="text-xl font-bold">お気に入り</h1>
              <button onClick={() => setCurrentView('home')} className="text-blue-500 text-sm">ホームへ</button>
            </div>

            {favoriteVenues.length === 0 ? (
              <div className="text-center py-12 text-gray-500">
                <i data-lucide="heart" className="w-12 h-12 mx-auto mb-4"></i>
                <p>お気に入りの施設がありません</p>
                <p className="text-sm mt-2">施設詳細でハートをタップしてお気に入りに追加してください</p>
              </div>
            ) : (
              <div className="space-y-4">
                {favoriteVenues.map(venue => (
                  <div key={venue.id} className="border rounded-lg p-4 bg-white shadow-sm">
                    <div className="flex gap-4">
                      <img src={venue.image} alt={venue.name} className="w-20 h-20 rounded-lg object-cover" />
                      <div className="flex-1">
                        <div className="flex justify-between items-start mb-2">
                          <div>
                            <h3 className="font-semibold text-gray-800">{venue.name}</h3>
                            <p className="text-sm text-gray-500">{venue.type}</p>
                          </div>
                          <button onClick={() => toggleFavorite(venue.id)} className="p-1">
                            <i data-lucide="heart" className="w-5 h-5 text-red-500 fill-current"></i>
                          </button>
                        </div>
                        <div className="flex items-center gap-2 mb-2">
                          <i data-lucide="star" className="w-4 h-4 text-yellow-400 fill-current"></i>
                          <span className="text-sm text-gray-600">{venue.rating}</span>
                          <i data-lucide="map-pin" className="w-4 h-4 text-gray-400"></i>
                          <span className="text-sm text-gray-600">{venue.distance}km</span>
                        </div>
                        <div className="flex items-center gap-2 mb-3">
                          {venue.amenities.map(amenity => (
                            <div key={amenity} className="flex items-center gap-1 text-xs bg-gray-100 px-2 py-1 rounded">
                              <i data-lucide={amenityIconNames[amenity]} className="w-3 h-3"></i>
                              <span>{amenity}</span>
                            </div>
                          ))}
                        </div>
                        <div className="flex justify-between items-center">
                          <div className="text-sm text-gray-600">
                            <span className="font-semibold text-lg text-green-600">¥{venue.minPrice}</span>
                            /15分〜
                          </div>
                          <button
                            onClick={() => { setSelectedVenue(venue); setCurrentView('venue-detail'); }}
                            className="px-4 py-2 bg-blue-500 text-white rounded-lg text-sm hover:bg-blue-600"
                          >
                            詳細・予約
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>
        );
      };

      const ProfileView = () => (
        <div className="space-y-6">
          <div className="flex justify-between items-center">
            <h1 className="text-xl font-bold">マイページ</h1>
            <button onClick={() => setCurrentView('home')} className="text-blue-500 text-sm">ホームへ</button>
          </div>

          <div className="bg-white p-6 rounded-lg border">
            <div className="flex items-center gap-4 mb-6">
              <div className="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center text-white text-2xl font-bold">
                {mockUser.nickname.charAt(0)}
              </div>
              <div>
                <h2 className="text-xl font-semibold">{mockUser.nickname}</h2>
                <p className="text-gray-600">{mockUser.name}</p>
                <div className="flex items-center gap-2 mt-1">
                  <span className="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded">
                    {mockUser.memberType}会員
                  </span>
                </div>
              </div>
            </div>

            <div className="space-y-4">
              <div className="flex justify-between items-center py-3 border-b">
                <span className="text-gray-700">メールアドレス</span>
                <span className="text-gray-600">{mockUser.email}</span>
              </div>
              <div className="flex justify-between items-center py-3 border-b">
                <span className="text-gray-700">お気に入り数</span>
                <span className="text-blue-600 font-semibold">{favorites.length}件</span>
              </div>
              <div className="flex justify-between items-center py-3 border-b">
                <span className="text-gray-700">予約履歴数</span>
                <span className="text-blue-600 font-semibold">{bookings.length}件</span>
              </div>
            </div>

            <div className="mt-6 space-y-3">
              <button className="w-full py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200">プロフィール編集</button>
              <button className="w-full py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200">支払い方法設定</button>
              <button className="w-full py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200">通知設定</button>
              <button className="w-full py-3 bg-red-100 text-red-700 rounded-lg hover:bg-red-200">ログアウト</button>
            </div>
          </div>
        </div>
      );

      const BookingsView = () => (
        <div className="space-y-6">
          <div className="flex justify-between items-center">
            <h1 className="text-xl font-bold">予約一覧</h1>
            <button onClick={() => setCurrentView('home')} className="text-blue-500 text-sm">ホームへ</button>
          </div>

          {bookings.length === 0 ? (
            <div className="text-center py-12 text-gray-500">
              <i data-lucide="calendar" className="w-12 h-12 mx-auto mb-4"></i>
              <p>予約がありません</p>
            </div>
          ) : (
            <div className="space-y-4">
              {bookings.map(booking => (
                <div key={booking.id} className="bg-white p-4 rounded-lg border">
                  <div className="flex justify-between items-start mb-3">
                    <div>
                      <h3 className="font-semibold">{booking.venue.name}</h3>
                      <p className="text-sm text-gray-600">{booking.room.name}</p>
                    </div>
                    <span className="px-2 py-1 bg-green-100 text-green-800 text-xs rounded">
                      {booking.status === 'confirmed' ? '予約済み' : booking.status}
                    </span>
                  </div>
                  <div className="flex items-center gap-4 text-sm text-gray-600 mb-3">
                    <div className="flex items-center gap-1">
                      <i data-lucide="calendar" className="w-4 h-4"></i>
                      <span>{booking.date}</span>
                    </div>
                    <div className="flex items-center gap-1">
                      <i data-lucide="clock" className="w-4 h-4"></i>
                      <span>{booking.time} ({booking.duration}分)</span>
                    </div>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold">¥{booking.price}</span>
                    <div className="flex gap-2">
                      <button
                        onClick={() => { setCurrentBooking(booking); setCurrentView('qr-code'); }}
                        className="px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600"
                      >
                        QRコード
                      </button>
                      <button className="px-3 py-1 bg-red-500 text-white text-sm rounded hover:bg-red-600">キャンセル</button>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      );

      const QRCodeView = () => (
        <div className="space-y-6">
          <button onClick={() => setCurrentView('bookings')} className="text-blue-500 text-sm">← 戻る</button>

          <div className="bg-white p-6 rounded-lg border text-center">
            <h1 className="text-xl font-bold mb-4">チェックイン用QRコード</h1>

            {currentBooking && (
              <div className="space-y-6">
                <div className="bg-gray-50 p-4 rounded-lg">
                  {generateQRCode(currentBooking.id)}
                </div>

                <div className="space-y-2 text-sm">
                  <div className="flex justify-between"><span className="text-gray-600">予約ID</span><span className="font-mono font-semibold">#{currentBooking.id}</span></div>
                  <div className="flex justify-between"><span className="text-gray-600">施設</span><span>{currentBooking.venue.name}</span></div>
                  <div className="flex justify-between"><span className="text-gray-600">部屋</span><span>{currentBooking.room.name}</span></div>
                  <div className="flex justify-between"><span className="text-gray-600">日時</span><span>{currentBooking.date} {currentBooking.time}</span></div>
                </div>

                <div className="bg-blue-50 p-4 rounded-lg">
                  <p className="text-blue-800 text-sm">
                    <strong>使用方法：</strong><br/>
                    施設入口でこのQRコードをスキャンしてチェックインしてください
                  </p>
                </div>

                <button className="w-full py-3 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600">
                  <div className="flex items-center justify-center gap-2">
                    <i data-lucide="check" className="w-4 h-4"></i>
                    チェックイン完了
                  </div>
                </button>
              </div>
            )}
          </div>
        </div>
      );

      return (
        <div className="min-h-screen bg-gray-50">
          <div className="max-w-md mx-auto bg-white min-h-screen">
            <div className="p-4 pb-20">
              {currentView === 'home' && <HomeView />}
              {currentView === 'venue-detail' && <VenueDetailView />}
              {currentView === 'booking' && <BookingView />}
              {currentView === 'confirmation' && <ConfirmationView />}
              {currentView === 'bookings' && <BookingsView />}
              {currentView === 'favorites' && <FavoritesView />}
              {currentView === 'profile' && <ProfileView />}
              {currentView === 'qr-code' && <QRCodeView />}
            </div>

            <div className="fixed bottom-0 left-1/2 transform -translate-x-1/2 max-w-md w-full bg-white border-t border-gray-200">
              <div className="flex justify-around py-2">
                <button
                  onClick={() => setCurrentView('home')}
                  className={`flex flex-col items-center py-2 px-4 ${currentView === 'home' ? 'text-blue-500' : 'text-gray-500'}`}
                >
                  <i data-lucide="search" className="w-5 h-5"></i>
                  <span className="text-xs mt-1">検索</span>
                </button>
                <button
                  onClick={() => setCurrentView('bookings')}
                  className={`flex flex-col items-center py-2 px-4 ${currentView === 'bookings' ? 'text-blue-500' : 'text-gray-500'}`}
                >
                  <i data-lucide="calendar" className="w-5 h-5"></i>
                  <span className="text-xs mt-1">予約</span>
                </button>
                <button
                  onClick={() => setCurrentView('favorites')}
                  className={`flex flex-col items-center py-2 px-4 ${currentView === 'favorites' ? 'text-blue-500' : 'text-gray-500'}`}
                >
                  <i data-lucide="heart" className="w-5 h-5"></i>
                  <span className="text-xs mt-1">お気に入り</span>
                </button>
                <button
                  onClick={() => setCurrentView('profile')}
                  className={`flex flex-col items-center py-2 px-4 ${currentView === 'profile' ? 'text-blue-500' : 'text-gray-500'}`}
                >
                  <i data-lucide="user" className="w-5 h-5"></i>
                  <span className="text-xs mt-1">マイページ</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<SmartNapApp />);
  </script>
</body>
</html>
